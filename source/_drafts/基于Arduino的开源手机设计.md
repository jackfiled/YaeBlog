---
title: 基于Arduino的开源手机设计
tags:
---

# 基于Arduino的开源手机设计
>注意：本文是北京邮电大学全校公选课程“基于Arduino的开源手机设计”的开发记录。
>本文采用的开发板为邹俊伟老师设计的VSOP(Very Simple Opensourse Phone)开发板。

<!--more-->

# Arduino的简单介绍
Arduino是一款便捷灵活，方便上手的开源电子硬件平台，包括硬件与软件两个部分。硬件是指各种不同类型的Arduino开发板，而软件部分主
要是一个
被称为“Arduino”的IDE(集成开发环境)。该项目是由三个意大利的工程师在2005年开发的，Arduino这个名字是意大利一个国王的名字，同时
也是开发的一个工程师喜欢去的酒吧的名字。<br>
在本次课程中，我们采用的并不是Arduino常用的Atmega328P等芯片，而是由国内芯片设计公司乐鑫科技设计的ESP8266芯片。这是一个面向物
联网领域的高集成度，高性价比的MCU，并且在这颗芯片中还自带的由WiFi模块。这颗芯片的主频高达160MHz，运行速度比Arduino UNO采用的
ATmega328P快十倍有余。<br>
在本次课程提供的开发板上，采用了南京沁恒微电子股份有限公司设计的CH340作为串口通信芯片，还有一个名为Air202的GPRS/GSM模块，用
于实现基本的2G通信功能。除此之外，这块开发板还提供了一个加速度传感器，可以开发为计步器。<del>虽然这是一个老年机。</del><br>

# 开发环境的配置
在这篇文章中我将介绍两种开发这块开发板的方式，分别是采用Arduino官方IDE“Arduino”，或者采用时下流行的VScode进行配置开发。

## 使用Arduino进行开发
首先我们访问[Arduino的官网](https://www.arduino.cc),点击页面上方的[SOFTWARE](https://www.arduino.cc/en/software)进入下
载界面，
{% asset_img 1.png 下载界面%}
点击页面最上方的一个IDE版本右侧的最上方的"<strong>Windows</strong> Win7 and newer"下载软件的安装包。在点击下载链接之后，可
能会打开一个
让你支持Arduino的赞助页面，如果你是一个对开源软件有着执念的程序员，请随意支持。不想支持的人可以直接点击白底蓝字的“JUST 
DOWNLOAD”开始下载。<br>
在下载完成后，双击安装包进行安装，可以将这个软件安装到任意你想要安装的位置。<br>
>注意：如果你想使用Vscode来开发自己的Arduino，请一定记住现在安装的路径。

双击打开，我们就会看到Arduino这个IDE简洁的界面
{% asset_img 2.png 简洁的界面%}
但是，因为我们所使用开发板并不是Arduino官方的开发板，所以在刚刚下载的IDE中点击工具下拉菜单在“开发板”选项中并不会看见我们使用
的开发板，因
因此我们需要在Arduino中下载用来开发我们所有的开发板的软件包。<br>
点击“文件”下拉菜单，点击“首选项”以打开设置界面。在设置界面首页的“附加开发板管理器网址”中填入
>http://arduino.esp8266.com/stable/package_esp8266com_index.json

然后点击好保存退出。<br>
此时再依次点击“工具”下拉菜单，“开发板”，“开发板管理器”来打开开发板管理器。
{% asset_img 3.png 开发板管理器%}
在上面的搜索框中输入8266进行搜索，找到一个名为“esp8266”的开发包，选择最新版本进行安装。
{% asset_img 4.png 找到%}
>这里已经进行了一次安装，大家看到的界面可能和图片上的界面不太一样。

当然到这里，可能有人会认为，我们可以将Arduino通过USB线缆连接在电脑上，快乐的开始自己的手机设计之旅了。但是，还不行。原因很简
单，我们还没有安装驱动。驱动时连接硬件程序与软件之间的桥梁，我们的先搭建一座桥梁，我们的数据才能正常的传输进入我们的硬件中。我
们所用的通信芯片是CH340,所以我们在网上搜索，找到驱动程序的下载界面[下载界面](http://www.wch.cn/downloads/CH341SER_EXE.
html)，点击下载之后运行安装驱动程序，之后我们便可以在Arduino的“工具”下拉菜单中“端口”中看见我们的Arduino所在的端口<del>当然
你得先把自己的开发板用Type-C的数据线连接在电脑的任意一个USB接口上</del>。<br>

## 使用VScode进行的开发
总所周知，Visual Studio Code是微软开发的新一代文本编辑器，一经推出就广受好评。而且由于Arduino只是一个入门级的IDE，只提供了
最基础的文本编辑功能与编译上传功能，在开发较为大型的项目时并不是十分适用。因此，我们可以将平时常用的VSCode改装为Arduino的
IDE.   
>至于为啥选VSCode，因为它拥有丰富的插件生态，可以方便的配置为一个好用的IDE

在VSCode中搜索安装一个名叫PlatformIO的插件，仅用这个插件就可以将VSCode打造成一个十分好用的Arduino开发软件。因为这个插件提供
了大量方便的功能，比如串口的自动选择，项目中各种库的下载与管理，而且这个插件不仅提供对于Arduino的支持，还可以利用这个插件将VS
Code配置可以写其他单片机，开发板的IDE。   
在安装玩这个插件之后，就会自动打开这个插件的主要管理界面
{% asset_img 5.png 插件的主界面%}
在这个界面可以管理我们已有的项目，安装会在项目中用到的库，管理连接在电脑上的设备等。    
点击“home”页面上的“New project”按钮，新建一个项目，输入项目的名称，选择项目使用的开发板,在这里我们选择NodeMCU0.9(ESP-12F)
这个开发板，PlatformIO会自动选择开发的框架为Arduino，我们点击确定，PlatformIO会开始下载相关的依赖库与编译环境，我们稍稍等待
一会就可以了。    
>这里在下载时，PlatformIO可能下载报错，不过它会自动选择其他的镜像进行下载，一般来说可以成功，

在项目创建完毕之后，我们就会在VSCode中看见PlatformIO创建的项目文件夹
{% asset_img 6.png 文件夹%}
在.pio文件夹中的是项目相关的依赖库，在.vscode文件夹中的是VSCode的配置文件，在include与lib中的是项目中使用到的私有库，具体有
什么区别可以查看这两个文件夹中的README文件，在src文件夹中存放我们项目的源代码，在test文件夹中存放这个项目的测试。   
现在我们就可以在src文件夹的mian.cpp文件中输入我们项目中需要使用的代码了。   

>本文的代码编写采用VSCode为开发环境

## 开发板的简单使用
### 祖传的点LED环节
不废话了，直接上代码。  
```
int LED = 2;

void setup()
{
    pinMode(LED, OUTPUT);
}

void loop()
{
    digitalWrite(LED, LOW);
    delay(1000);
    digitalWrite(LED, HIGH);
    delay(1000);
}
```
现在点击界面下方的箭头，将程序编译上传到开发板。如果不出以外的情况下，我们就可以看见板子上有一个蓝色的LED就会开始闪烁。    

### 祖传的串口通信实验
```
void setup()
{
    Serial.begin(9600);
}

void loop()
{
    int i =1;
    Serial.println(i);
    i++;
    delay(1000);
}
```
输入代码，将代码上传到开发板，点击下面的串口监视器图标，打开串口监视器，应该就可以看见每隔一秒输出一个数。   

### Arduino对于模拟量的读取

## 加速度传感器的测量
### 采用的加速度传感器
型号：KXTJ-1057   
这是一个三轴数字加速度计，可以在2g, 4g, 8g, 16g之中调节传感器的测量范围，但是随测量范围的变大，测量的精度下降。

## VSOP的技术文档
主控芯片为ESP8266(ESP-12F)   
GMS芯片为Air202   
串口芯片为CH340
并口扩展芯片为：PCF8574A7    
显示屏80x160彩色显示屏   


0号引脚上连接GSM-RX与一个按钮    
按钮是被上拉电阻上拉到3.3V     
2号引脚上连接GSM-TX与一个LED
LED是采用电流流入的连接方式      
4号引脚上连接SCL
5号引脚上连接SDA